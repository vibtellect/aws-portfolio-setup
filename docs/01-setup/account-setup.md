# 🚀 AWS Account Setup - Komplette Anleitung

**Ziel:** Sichere und kostenbewusste AWS-Entwicklungsumgebung einrichten  
**Zeitaufwand:** 60 Minuten  
**Voraussetzungen:** AWS Account mit Root-Zugang

---

## 1. 🔐 Root Account absichern (15 Minuten)

### **Schritt 1.1: MFA aktivieren**
```bash
# 1. AWS Console → Root Account → Security credentials
# 2. Multi-factor authentication (MFA) → Assign MFA device
# 3. Virtual MFA device auswählen
# 4. Authenticator App (Google/Microsoft/Authy) verwenden
# 5. QR-Code scannen + 2 MFA-Codes eingeben
```

**✅ Erfolgskontrolle:** Root Login erfordert jetzt MFA

### **Schritt 1.2: Root Access Keys deaktivieren**
```bash
# 1. AWS Console → Root Account → Security credentials
# 2. Access keys → Deactivate (falls vorhanden)
# 3. Alternative: Delete (empfohlen)
```

**⚠️ Wichtig:** Root Keys niemals für Development verwenden!

---

## 2. 👤 IAM Development User erstellen (20 Minuten)

### **Schritt 2.1: IAM User anlegen**
```bash
# 1. AWS Console → IAM → Users → Add user
# 2. User name: "vitalij-dev"
# 3. Access type: "Programmatic access" + "AWS Management Console access"
# 4. Console password: "Autogenerated" oder Custom
# 5. Require password reset: ✅ (empfohlen)
```

### **Schritt 2.2: Enhanced Developer Policy anhängen**
```bash
# 1. IAM → Users → vitalij-dev → Permissions
# 2. Add permissions → Attach policies directly
# 3. Create policy → JSON → Copy enhanced-developer-policy.json
# 4. Policy name: "EnhancedDeveloperAccess"
# 5. Attach policy to user
```

**📁 Policy Location:** `02-iam-policies/developer-policy-enhanced.json`

### **Schritt 2.3: MFA für Development User**
```bash
# 1. IAM → Users → vitalij-dev → Security credentials
# 2. Assigned MFA device → Assign
# 3. Virtual MFA device
# 4. Neues Device in Authenticator App hinzufügen
```

---

## 3. 🔧 AWS CLI konfigurieren (10 Minuten)

### **Schritt 3.1: Access Keys erstellen**
```bash
# 1. IAM → Users → vitalij-dev → Security credentials
# 2. Create access key → Command Line Interface (CLI)
# 3. ⚠️ WICHTIG: Keys sicher speichern!
```

### **Schritt 3.2: CLI konfigurieren**
```bash
# AWS CLI installieren (falls nicht vorhanden)
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install

# Profile konfigurieren
aws configure --profile dev
# AWS Access Key ID: [DEIN_ACCESS_KEY]
# AWS Secret Access Key: [DEIN_SECRET_KEY]  
# Default region name: eu-central-1
# Default output format: json

# Profile als Default setzen
export AWS_PROFILE=dev
echo 'export AWS_PROFILE=dev' >> ~/.bashrc
```

### **Schritt 3.3: CLI testen**
```bash
# Basic test
aws sts get-caller-identity

# Sollte zeigen:
# {
#     "UserId": "AIDACKCEVSQ6C2EXAMPLE",
#     "Account": "123456789012", 
#     "Arn": "arn:aws:iam::123456789012:user/vitalij-dev"
# }
```

---

## 4. 💰 Budget & Cost Controls einrichten (10 Minuten)

### **Schritt 4.1: Budget Alerts konfigurieren**
```bash
# 1. AWS Console → AWS Cost Management → Budgets
# 2. Create budget → Cost budget
# 3. Budget name: "Development-Budget"
# 4. Budgeted amount: 15.00 USD
# 5. Budget scope: All AWS services
# 6. Time period: Monthly, Recurring
```

### **Schritt 4.2: Alert Konfiguration**
```bash
# Alert 1: 50% erreicht
# Alert type: Actual
# Threshold: 50% of budgeted amount
# Email: deine-email@domain.com

# Alert 2: 80% erreicht  
# Alert type: Actual
# Threshold: 80% of budgeted amount
# Email: deine-email@domain.com

# Alert 3: 100% erreicht
# Alert type: Forecasted
# Threshold: 100% of budgeted amount  
# Email: deine-email@domain.com
```

### **Schritt 4.3: Free Tier Alerts aktivieren**
```bash
# 1. AWS Console → Billing → Preferences
# 2. Cost Management preferences
# 3. ✅ Receive Free Tier alerts
# 4. Email address: deine-email@domain.com
```

---

## 5. 🛡️ Security Best Practices (15 Minuten)

### **Schritt 5.1: CloudTrail aktivieren**
```bash
# 1. AWS Console → CloudTrail → Trails
# 2. Create trail
# 3. Trail name: "dev-audit-trail"
# 4. Storage location: Create new S3 bucket
# 5. Log file SSE-KMS encryption: ✅
# 6. Enable for all regions: ✅
```

### **Schritt 5.2: IAM Access Analyzer**
```bash
# 1. AWS Console → IAM → Access Analyzer
# 2. Create analyzer
# 3. Analyzer name: "dev-access-analyzer"
# 4. Zone of trust: Current account
```

### **Schritt 5.3: AWS Config (Optional, kostet extra)**
```bash
# Nur aktivieren wenn Budget > 10€/Monat
# 1. AWS Console → AWS Config
# 2. Get started → Include global resources
# 3. S3 bucket: Create new bucket
# 4. Delivery method: Stream configuration changes and notifications to SNS
```

---

## 6. ✅ Setup-Validierung (10 Minuten)

### **Schritt 6.1: Permission Testing**
```bash
# Vollständigen Permission-Test ausführen
cd /home/vitalij/projects/aws-portfolio-setup
./scripts/test-iam-permissions.sh

# Erwartetes Ergebnis: 38/38 Tests bestanden
```

### **Schritt 6.2: Cost Management Test**
```bash
# Cost Management Tools testen
./scripts/cost-management.sh analyze

# Sollte zeigen:
# ✅ AWS CLI configured
# ✅ Cost Explorer access
# ✅ Budget access
# 📊 Current month costs: $X.XX
```

### **Schritt 6.3: Free Tier Status prüfen**
```bash
# 1. AWS Console → Billing → Free Tier
# 2. Prüfen: Account Creation Date vor 15.07.2025
# 3. Verfügbare Services: EC2, RDS, S3, etc.
# 4. Aktuelle Nutzung: Sollte bei 0% stehen
```

---

## 7. 📋 Setup-Checkliste

### **Account Security:**
- [ ] ✅ Root MFA aktiviert
- [ ] ✅ Root Access Keys deaktiviert/gelöscht
- [ ] ✅ IAM Development User erstellt
- [ ] ✅ Development User MFA aktiviert
- [ ] ✅ Enhanced Developer Policy angehängt

### **CLI & Access:**
- [ ] ✅ AWS CLI installiert & konfiguriert
- [ ] ✅ `aws sts get-caller-identity` funktioniert
- [ ] ✅ Default Profile auf 'dev' gesetzt
- [ ] ✅ Region: eu-central-1

### **Cost Management:**
- [ ] ✅ Budget erstellt (15€/Monat)
- [ ] ✅ 3 Budget Alerts konfiguriert (50%, 80%, 100%)
- [ ] ✅ Free Tier Alerts aktiviert
- [ ] ✅ E-Mail für Alerts konfiguriert

### **Security & Monitoring:**
- [ ] ✅ CloudTrail aktiviert (alle Regionen)
- [ ] ✅ IAM Access Analyzer erstellt
- [ ] ✅ S3 Bucket für Logs erstellt
- [ ] 🔧 AWS Config (optional, bei größerem Budget)

### **Validierung:**
- [ ] ✅ 38/38 Permission Tests bestanden
- [ ] ✅ Cost Management Tools funktional
- [ ] ✅ Free Tier Status korrekt angezeigt

---

## 8. 🚨 Troubleshooting

### **Problem: CLI Zugriff verweigert**
```bash
# Solution: MFA Token erforderlich
aws sts get-session-token --serial-number arn:aws:iam::ACCOUNT:mfa/vitalij-dev --token-code 123456

# Temporäre Credentials verwenden
export AWS_ACCESS_KEY_ID=ASIA...
export AWS_SECRET_ACCESS_KEY=...  
export AWS_SESSION_TOKEN=...
```

### **Problem: Permission denied Fehler**
```bash
# 1. Policy prüfen
aws iam list-attached-user-policies --user-name vitalij-dev

# 2. Policy Version prüfen
aws iam get-policy --policy-arn arn:aws:iam::ACCOUNT:policy/EnhancedDeveloperAccess

# 3. Enhanced Policy neu anhängen (siehe IAM Setup Guide)
```

### **Problem: Budget Alerts kommen nicht an**
```bash
# 1. E-Mail-Adresse in Budget Settings prüfen
# 2. Spam-Ordner prüfen
# 3. AWS SNS Topic Subscriptions prüfen:
aws sns list-topics
aws sns list-subscriptions
```

### **Problem: Free Tier Status unklar**
```bash
# 1. Account Creation Date prüfen:
aws organizations describe-account --account-id ACCOUNT_ID

# 2. Free Tier Usage API:
aws ce get-usage-forecast --time-period Start=2024-01-01,End=2024-02-01 --metric BlendedCost --granularity MONTHLY
```

---

## 9. 🎯 Nächste Schritte

1. **Free Tier Monitoring:** [Free Tier Guide](../02-free-tier/official-limits.md)
2. **Cost Management:** [Budget Management](../03-cost-analysis/budget-management.md) 
3. **Erstes Projekt:** [EC2 Hello World](../04-projects/01-serverless-api.md)
4. **Security Hardening:** [Security Best Practices](security-guide.md)

---

## 📞 Support

Bei Problemen:
1. **AWS Support Center** (Basic Plan verfügbar)
2. **AWS Forums:** https://forums.aws.amazon.com/
3. **AWS Documentation:** https://docs.aws.amazon.com/
4. **Local AWS User Groups**

---

**💡 Wichtiger Hinweis:** Dieser Setup sollte bei korrekter Ausführung **0€ Kosten** verursachen. Alle verwendeten Services sind im Free Tier enthalten!